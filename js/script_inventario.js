let lista_instrumento = [{
    codigo: "001",
    tipo: "Estación Total",
    marca: "Topcon",
    modelo: "GPT-3107w",
    estado: "B",
    nro_serie: "8S2180",
    patrimonio: 18015,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "no reportado",
    img: "/imagenes/Topcon.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{   codigo: "002",
    tipo: "Estación Total",
    marca: "Topcon",
    modelo: "GPT-3107w",
    estado: "B",
    nro_serie: "8S2189",
    patrimonio: 18016,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "no reportado",
    img: "/imagenes/Topcon.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "003",
    tipo: "Estación Total",
    marca: "Topcon",
    modelo: "GTS 212",
    estado: "B",
    nro_serie: "LH 5595",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "recuperada de desguase",
    img: "/imagenes/Topcon.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "004",
    tipo: "Estación Total",
    marca: "Topcon",
    modelo: "GTS 213",
    estado: "B",
    nro_serie: "LJ1473",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "recuperada de desguase",
    img: "/imagenes/Topcon.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "005",
    tipo: "Estación Total",
    marca: "Topcon",
    modelo: "es-55",
    estado: "B",
    nro_serie: "WL0654",
    patrimonio: 23392,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "no reportado",
    img: "ruta de imagen",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "006",
    tipo: "Estación Total",
    marca: "Leica",
    modelo: "TC-600",
    estado: "B",
    nro_serie: "663240",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "no reportado",
    img: "imagenes/leica.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "007",
    tipo: "Estación Total",
    marca: "Leica",
    modelo: "TC-705",
    estado: "B",
    nro_serie: "667305",
    patrimonio: 3500,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "no reportado",
    img: "imagenes/leica.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "008",
    tipo: "Estación Total",
    marca: "Pentax",
    modelo: "V-227",
    estado: "B",
    nro_serie: "866717",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "no reportado",
    img: "imagenes/Topcon.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "009",
    tipo: "Estación Total",
    marca: "CHC",
    modelo: "CTS 112R4",
    estado: "B",
    nro_serie: "H06304",
    patrimonio: 25633,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "no reportado",
    img: "imagenes/chc.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "010",
    tipo: "Estación Total",
    marca: "Trimble",
    modelo: "3605 DR",
    estado: "B",
    nro_serie: "506699A",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "recuperada de desguase, no funciona bajada de datos",
    img: "imagenes/Topcon.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "011",
    tipo: "Estación Total",
    marca: "Trimble",
    modelo: "3605 DR",
    estado: "B",
    nro_serie: "507386A",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de ángulos y distancias",
    observaciones: "recuperada de desguase, no funciona bajada de datos",
    img: "imagenes/Topcon.jpg",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "012",
    tipo: "Equialtimetro automatico",
    marca: "South",
    modelo: "South 32A",
    estado: "B",
    nro_serie: "507386A",
    patrimonio: null,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "013",
    tipo: "Equialtimetro automatico",
    marca: "Sokkia",
    modelo: "C26",
    estado: "B",
    nro_serie: "001333",
    patrimonio: 17594,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "caja original remplazada",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "014",
    tipo: "Equialtimetro automatico",
    marca: "Nikon",
    modelo: "AC-2s",
    estado: "B",
    nro_serie: "678508",
    patrimonio: 22364,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "015",
    tipo: "Equialtimetro digital",
    marca: "Leica",
    modelo: "Sprinter 150M",
    estado: "B",
    nro_serie: "210322",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica para determinar diferencias de alturas",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "016",
    tipo: "Equialtimetro automatico",
    marca: "Kolida",
    modelo: "KL-28",
    estado: "B",
    nro_serie: "1141278",
    patrimonio: null,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "en servicio tecnico RUNCO",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "017",
    tipo: "Equialtimetro automatico",
    marca: "Kolida",
    modelo: "KL-28",
    estado: "B",
    nro_serie: "1141230",
    patrimonio: null,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "en servicio tecnico RUNCO",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "018",
    tipo: "Equialtimetro automatico",
    marca: "Zeiss",
    modelo: "Ni-2",
    estado: "B",
    nro_serie: "143675",
    patrimonio: null,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "caja rota",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "019",
    tipo: "Equialtimetro automatico",
    marca: "Zeiss",
    modelo: "Ni-2",
    estado: "B",
    nro_serie: "143265",
    patrimonio: null,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "caja rota",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "020",
    tipo: "Equialtimetro automatico",
    marca: "Topcon",
    modelo: null,
    estado: "B",
    nro_serie: "143265",
    patrimonio: null,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "021",
    tipo: "Equialtimetro automatico",
    marca: "Topcon",
    modelo: null,
    estado: "B",
    nro_serie: "143265",
    patrimonio: null,
    descripcion: "Instrumento de medición óptica de ángulos y distancias para determinar diferencias de alturas",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "022",
    tipo: "GNSS",
    marca: "Kolida",
    modelo: "K7",
    estado: "B",
    nro_serie: null,
    patrimonio: null,
    descripcion: "Instrumento de posicionamiento satelital",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "023",
    tipo: "GNSS",
    marca: "CHC",
    modelo: "i50",
    estado: "B",
    nro_serie: 3372934,
    patrimonio: null,
    descripcion: "Instrumento de posicionamiento satelital",
    observaciones: "en reparación en GEOSISTEMAS",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "024",
    tipo: "GNSS",
    marca: "Trimble",
    modelo: "R8s",
    estado: "B",
    nro_serie: "5513R00113,5513R00283,15480560024,14373117",
    patrimonio: 22726,
    descripcion: "Instrumento de posicionamiento satelital",
    observaciones: "incovenientes en la colectora",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "025",
    tipo: "GNSS",
    marca: "Trimble",
    modelo: "R8s",
    estado: "B",
    nro_serie: "5513R00113,5513R00283,15480560024,14373117",
    patrimonio: 22726,
    descripcion: "Instrumento de posicionamiento satelital",
    observaciones: "incovenientes en la colectora",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "026",
    tipo: "GNSS",
    marca: "Magellan",
    modelo: "NAP100",
    estado: "B",
    nro_serie: "200725014,200845166",
    patrimonio: null,
    descripcion: "Instrumento de posicionamiento satelital",
    observaciones: "incovenientes en la colectora",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "027",
    tipo: "Distanciometro laser",
    marca: "Stanley",
    modelo: "TLM210",
    estado: "B",
    nro_serie: "20550232532",
    patrimonio: 17596,
    descripcion: "Instrumento de medición electrónica de distancias",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "028",
    tipo: "Distanciometro laser",
    marca: "Leica",
    modelo: "Disto Classic Leica",
    estado: "B",
    nro_serie: "226863",
    patrimonio: 11834,
    descripcion: "Instrumento de medición electrónica de distancias",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "029",
    tipo: "Distanciometro laser",
    marca: "Leica",
    modelo: "A5",
    estado: "B",
    nro_serie: "1060650948",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de distancias",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},

{
    codigo: "030",
    tipo: "Distanciometro laser",
    marca: "Leica",
    modelo: "A5",
    estado: "B",
    nro_serie: "1074871307",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de distancias",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "031",
    tipo: "Distanciometro laser",
    marca: "Leica",
    modelo: "D810",
    estado: "B",
    nro_serie: "792297",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de distancias",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: true,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
},
{
    codigo: "032",
    tipo: "DRONE-CUADRICOPTERO",
    marca: "DJI",
    modelo: "MATRICE 200",
    estado: "B",
    nro_serie: "0FZDEBL0P20234,",
    patrimonio: null,
    descripcion: "Instrumento de medición electrónica de distancias",
    observaciones: "no reportado",
    img: "imagenes/sin_imagen.JPG",
    manual: "ruta de manual",
    eindice:null,
    ecolimacion:null,
    disponibilidad: false,
    diai: null,
    diaf: null,
    horai:null,
    horaf:null,
}];
localStorage.setItem("lista_instrumento", JSON.stringify(lista_instrumento));
lista_usuario = JSON.parse(localStorage.getItem("lista_usuario")) || [];
const user = JSON.parse(localStorage.getItem("usuario"));

const contenedor = document.getElementById('contenedorInstrumentos');
const filtroTipo = document.getElementById('filtroTipo');
const filtroMarca = document.getElementById('filtroMarca');
const filtroDispo = document.getElementById('filtroDispo');

function cargarFiltros() {
    // Limpia opciones previas
    filtroTipo.innerHTML = '<option value="">Todos</option>';
    filtroMarca.innerHTML = '<option value="">Todas</option>';
    filtroDispo.innerHTML = '<option value="">Todas</option>';


    let tipos = []; // arreglo donde guardaremos los tipos únicos
    for (let i = 0; i < lista_instrumento.length; i++) {
        let tipoActual = lista_instrumento[i].tipo;
        // si el tipo aún no está en el array, lo agregamos
        if (tipos.indexOf(tipoActual) === -1) {
            tipos.push(tipoActual);
        }
    }
    tipos.forEach(tipo => {
        const option = document.createElement("option");
        option.value = tipo;
        option.textContent = tipo;
        filtroTipo.appendChild(option);
    });

    // Este se actualizará dinámicamente luego según tipo
    actualizarMarcasPorTipo(); 


    let disponibilidad = []; // arreglo donde guardaremos los tipos únicos
    for (let i = 0; i < lista_instrumento.length; i++) {
        let dispo = lista_instrumento[i].disponibilidad;
        // si el tipo aún no está en el array, lo agregamos
        if (disponibilidad.indexOf(dispo) === -1) {
            disponibilidad.push(dispo);
        }
    }
    disponibilidad.forEach(valor => {
        const option = document.createElement("option");
        option.value = valor;
        option.textContent = valor === true ? "Sí" : "No";
        filtroDispo.appendChild(option);
    });
}

function actualizarMarcasPorTipo() {
    const tipoSeleccionado = filtroTipo.value;
    filtroMarca.innerHTML = '<option value="">Todas</option>';

    let marcas;
    if (tipoSeleccionado === "") {
        //marcas = [...new Set(lista_instrumento.map(i => i.marca))];
        let todasLasMarcas = lista_instrumento.map(function (i) { return i.marca; });
        // 2. Filtrar duplicados
        let sinDuplicados = [];
        todasLasMarcas.forEach(function (m) {
        if (sinDuplicados.indexOf(m) === -1) sinDuplicados.push(m);
        });
        // 3. Asignar
        marcas = sinDuplicados;
    } else {
        marcas = [];
        for (let i = 0; i < lista_instrumento.length; i++) {
            let instrumento = lista_instrumento[i];
            // 1) mismo tipo que el seleccionado
            if (instrumento.tipo === tipoSeleccionado) {
                // 2) si la marca no está todavía en el array, la agregamos
                if (marcas.indexOf(instrumento.marca) === -1) {
                marcas.push(instrumento.marca);
                }
            }
            }
        }

    marcas.forEach(marca => {
        const option = document.createElement("option");
        option.value = marca;
        option.textContent = marca;
        filtroMarca.appendChild(option);
    });
}

function mostrarInstrumentos() {
    const tipoSeleccionado = filtroTipo.value;
    const marcaSeleccionada = filtroMarca.value;
    const dispoSeleccionada = filtroDispo.value;

    const filtrados = lista_instrumento.filter(instr => {
        const coincideTipo = tipoSeleccionado === "" || instr.tipo === tipoSeleccionado;
        const coincideMarca = marcaSeleccionada === "" || instr.marca === marcaSeleccionada;
        const coincideDispo = dispoSeleccionada === "" || String(instr.disponibilidad) === dispoSeleccionada;
        return coincideTipo && coincideMarca && coincideDispo;
    });

    contenedor.innerHTML = "";
    if (filtrados.length === 0) {
        contenedor.innerHTML = "<p>No se encontraron instrumentos.</p>";
        return;
    }

    filtrados.forEach(instr => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
            <h3>${instr.tipo} - ${instr.marca} ${instr.modelo || ""}</h3>
            <img src="${instr.img}" alt="Imagen de ${instr.marca}" onerror="this.src='/imagenes/sin_imagen.JPG'">
            <p><strong>Código:</strong> ${instr.codigo}</p>
            <p><strong>Descripción:</strong> ${instr.descripcion}</p>
            <p><strong>Observaciones:</strong> ${instr.observaciones}</p>
            <p><strong>Errores:</strong> Ec = ${instr.ecolimacion} - Ei = ${instr.eindice}</p>
            <p><strong>Manual:</strong> <a href="${instr.manual}" target="_blank">Ver Manual</a></p>
        `;
        if (instr.estado === "B") {
            div.classList.add("sombra-verde");
        } else if (instr.estado === "R") {
            div.classList.add("sombra-amarilla");
        } else if (instr.estado === "M") {
            div.classList.add("sombra-roja");
        }
        contenedor.appendChild(div);
    });
}
// Cuando cambia el tipo, actualiza marcas
filtroTipo.addEventListener("change", () => {
    actualizarMarcasPorTipo();
    mostrarInstrumentos();
});

filtroMarca.addEventListener("change", mostrarInstrumentos);
filtroDispo.addEventListener("change", mostrarInstrumentos);

// Llamada
cargarFiltros();
mostrarInstrumentos();